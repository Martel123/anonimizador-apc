ROL DEL AGENTE

Act√∫a como arquitecto full-stack senior especializado en LegalTech, con experiencia en:

Sistemas SaaS

Control de accesos por rol

Gesti√≥n documental jur√≠dica

Conversi√≥n de documentos Word/PDF

Seguridad y privacidad de datos

UX para abogados

Debes modificar y extender el sistema existente cumpliendo estrictamente las reglas descritas abajo.

üîê PRIORIDAD ABSOLUTA DEL PROYECTO (LO M√ÅS IMPORTANTE)

El m√≥dulo de MODELOS DE DOCUMENTOS (antes ‚ÄúPlantillas‚Äù) y ESTILOS DE REDACCI√ìN debe cumplir PRIVACIDAD ESTRICTA POR USUARIO, con UNA SOLA EXCEPCI√ìN:

üëâ SOLO EL ADMINISTRADOR puede ver todo
üëâ Coordinadores y Usuarios SOLO pueden ver LO SUYO

Esto es CR√çTICO, NO NEGOCIABLE y debe aplicarse en:

Base de datos

Backend (autorizaci√≥n)

Frontend (UI)

Acceso a archivos

Descargas

Conversi√≥n de documentos

1Ô∏è‚É£ REGLAS DE VISIBILIDAD (CLARAS Y OBLIGATORIAS)
Rol	Visibilidad de Modelos y Estilos
Admin	Ve y gestiona todos
Coordinador	Solo los suyos
Usuario	Solo los suyos

El admin puede ver, editar, eliminar, convertir y descargar modelos/estilos de cualquier usuario.

Coordinadores y usuarios NUNCA pueden ver ni acceder a recursos de otros usuarios, ni siquiera por URL directa.

2Ô∏è‚É£ CAMBIO DE CONCEPTO Y NOMENCLATURA

Reemplazar completamente ‚ÄúPlantillas‚Äù por ‚ÄúModelos‚Äù en:

UI

Rutas

C√≥digo

Variables

Base de datos

3Ô∏è‚É£ MODELOS DE DOCUMENTOS (POR USUARIO)

Cada usuario debe tener su propio apartado privado con:

Funcionalidades

Crear modelo

Subir archivo

Convertir documento

Configurar campos

Descargar original

Descargar convertido

Editar

Eliminar

Activar / desactivar

Restricci√≥n

Coordinadores/usuarios ‚Üí SOLO sus modelos

Admin ‚Üí todos

Cada modelo debe tener obligatoriamente:

owner_user_id

nombre

estado

archivo original

archivo convertido (si existe)

metadata

4Ô∏è‚É£ ESTILOS DE REDACCI√ìN (POR USUARIO)

Cada usuario debe poder:

Crear estilos de redacci√≥n

Editar

Eliminar

Marcar uno como predeterminado

Los estilos:

Se guardan en base de datos

Tienen owner_user_id

NO se cargan solo desde archivos del sistema

Visibilidad:

Admin ‚Üí todos

Coordinador/Usuario ‚Üí solo los suyos

5Ô∏è‚É£ SEGURIDAD T√âCNICA (IMPLEMENTACI√ìN OBLIGATORIA)
Capa 1: Queries

Coordinador/Usuario:

WHERE owner_user_id = current_user.id


Admin: sin restricci√≥n (puede filtrar por usuario)

Capa 2: Acceso por ID

En endpoints tipo /modelos/:id o /estilos/:id:

Si NO es admin y no es due√±o ‚Üí 403 Forbidden

Capa 3: Archivos

Validar siempre que:

el archivo pertenece al usuario

o el usuario es admin

6Ô∏è‚É£ ESTRUCTURA DE ARCHIVOS (CR√çTICO)

Guardar archivos separados por usuario:

/uploads/<owner_user_id>/modelos/original/
/uploads/<owner_user_id>/modelos/convertido/


Nunca permitir:

Descargar archivos de otro usuario

Acceder por path directo sin validaci√≥n

7Ô∏è‚É£ SUBIDA DE ARCHIVOS (MULTI-FORMATO)

Permitir subir archivos con texto:

.docx

.doc

.pdf

.txt

El sistema debe:

Extraer texto

Permitir conversi√≥n a modelo

Mostrar error claro si no se puede leer

8Ô∏è‚É£ CONVERSOR DE DOCUMENTOS ‚Üí PLACEHOLDERS {{ }}
M√©todo A ‚Äî Placeholders expl√≠citos (prioridad m√°xima)

Detectar {{campo}} y [[CAMPO]]
enlightened:

Convertirlos directamente en campos

Nunca inventar campos desde texto normal

M√©todo B ‚Äî Documentos antiguos (huecos visuales)

Detectar SOLO patrones fuertes:

...... (‚â• 6 puntos)

_____ (‚â• 5 guiones)

(........)

N¬∞ ____, DNI N¬∞ ______

‚ö†Ô∏è Nunca convertir palabras normales como ‚ÄúLima‚Äù, ‚Äúde‚Äù, frases completas.

Confirmaci√≥n visual obligatoria

Mostrar contexto del hueco

Permitir:

Convertir

Ignorar

Editar label y key

Elegir tipo de campo

Conversi√≥n final

Reemplazar huecos confirmados por {{key}} en el documento

Mantener formato lo m√°s posible

Generar archivo convertido descargable

9Ô∏è‚É£ DESCARGA DEL DOCUMENTO CONVERTIDO (BUG A SOLUCIONAR)

Al presionar ‚ÄúDescargar documento convertido‚Äù:

El archivo debe descargarse correctamente

Usar Content-Disposition: attachment

Manejar nombres con espacios

Si no existe ‚Üí 404 con mensaje claro

üîü UI / EXPERIENCIA

Cada usuario ve:

‚ÄúMis Modelos‚Äù

‚ÄúMis Estilos de Redacci√≥n‚Äù

Admin ve:

Todos los modelos y estilos

Puede filtrar por usuario

Coordinador/Usuario:

NO pueden cambiar de usuario

NO pueden ver recursos ajenos

1Ô∏è‚É£1Ô∏è‚É£ PRUEBAS OBLIGATORIAS

Considerar el m√≥dulo terminado solo si:

Usuario A NO ve modelos de Usuario B

Coordinador recibe 403 al acceder a modelo ajeno

Admin puede acceder a todos

Descargas est√°n protegidas

Conversi√≥n funciona sin crear campos absurdos

üì¶ ENTREGABLES

Cambios en base de datos (owner_user_id)

Endpoints seguros

Conversor funcionando

UI actualizada

Bug de descarga corregido

Explicaci√≥n breve del plan antes de codificar