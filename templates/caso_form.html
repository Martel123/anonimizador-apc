{% extends "base_dashboard.html" %}

{% block title %}{% if caso %}Editar Caso{% else %}Nuevo Caso{% endif %}{% endblock %}
{% block page_title %}{% if caso %}Editar Caso{% else %}Nuevo Caso{% endif %}{% endblock %}
{% block page_subtitle %}{% if caso %}Modifica la información del caso{% else %}Registra un nuevo caso o expediente{% endif %}{% endblock %}

{% block content %}
<div class="max-w-4xl">
    <form method="post" class="space-y-6">
        <div class="bg-white rounded-xl shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-info-circle text-blue-500 mr-2"></i>Información General
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Título del Caso *</label>
                    <input type="text" name="titulo" value="{{ caso.titulo if caso else '' }}" required
                           class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Ej: Demanda de alimentos - García vs. López">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">N° Expediente</label>
                    <input type="text" name="numero_expediente" value="{{ caso.numero_expediente if caso else '' }}"
                           class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Ej: 00123-2024-0-1801-JR-FC-01">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Caso</label>
                    <input type="text" name="tipo_caso" value="{{ caso.tipo_caso if caso else '' }}"
                           class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Ej: Derecho de Familia">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Estado</label>
                    <select name="estado" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                        {% for key, label in estados.items() %}
                        <option value="{{ key }}" {% if (caso and caso.estado == key) or (not caso and key == 'por_comenzar') %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Prioridad</label>
                    <select name="prioridad" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                        {% for key, label in prioridades.items() %}
                        <option value="{{ key }}" {% if (caso and caso.prioridad == key) or (not caso and key == 'media') %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Juzgado</label>
                    <input type="text" name="juzgado" value="{{ caso.juzgado if caso else '' }}"
                           class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Ej: 1° Juzgado de Familia de Lima">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Fecha Límite</label>
                    <input type="date" name="fecha_limite" value="{{ caso.fecha_limite.strftime('%Y-%m-%d') if caso and caso.fecha_limite else '' }}"
                           class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Descripción</label>
                    <textarea name="descripcion" rows="3"
                              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                              placeholder="Descripción breve del caso...">{{ caso.descripcion if caso else '' }}</textarea>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-user text-green-500 mr-2"></i>Cliente
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nombre del Cliente *</label>
                    <input type="text" name="cliente_nombre" value="{{ caso.cliente_nombre if caso else '' }}" required
                           class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Nombre completo">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" name="cliente_email" value="{{ caso.cliente_email if caso else '' }}"
                           class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="cliente@email.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                    <input type="tel" name="cliente_telefono" value="{{ caso.cliente_telefono if caso else '' }}"
                           class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="+51 999 999 999">
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-user-tie text-red-500 mr-2"></i>Contraparte
            </h3>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre de la Contraparte</label>
                <input type="text" name="contraparte_nombre" value="{{ caso.contraparte_nombre if caso else '' }}"
                       class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       placeholder="Nombre de la parte contraria">
            </div>
        </div>

        {% if not caso %}
        <div class="bg-white rounded-xl shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-user-check text-purple-500 mr-2"></i>Asignación
            </h3>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Abogado Responsable</label>
                <select name="responsable_id" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">Sin asignar</option>
                    {% for usuario in usuarios %}
                    <option value="{{ usuario.id }}">{{ usuario.username }} ({{ usuario.email }})</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        {% endif %}

        <div class="bg-white rounded-xl shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-sticky-note text-yellow-500 mr-2"></i>Notas Adicionales
            </h3>
            <textarea name="notas" rows="4"
                      class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="Notas internas sobre el caso...">{{ caso.notas if caso else '' }}</textarea>
        </div>

        <div class="flex items-center justify-between">
            <a href="{{ url_for('casos') if not caso else url_for('caso_detalle', caso_id=caso.id) }}" 
               class="px-6 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors">
                <i class="fas fa-arrow-left mr-2"></i> Cancelar
            </a>
            <button type="submit" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                <i class="fas fa-save mr-2"></i> {% if caso %}Guardar Cambios{% else %}Crear Caso{% endif %}
            </button>
        </div>
    </form>
</div>
{% endblock %}
