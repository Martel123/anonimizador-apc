{% extends "base_dashboard.html" %}

{% block title %}Resultado de Revision{% endblock %}
{% block page_title %}Resultado de Revision IA{% endblock %}
{% block page_subtitle %}{{ review.nombre_documento }}{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <a href="{{ url_for('revisor_ia') }}" class="text-blue-600 hover:text-blue-700 flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>Volver al Revisor
        </a>
        <span class="text-sm text-gray-500">
            <i class="fas fa-clock mr-1"></i>{{ review.created_at.strftime('%d/%m/%Y %H:%M') }}
        </span>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <div class="flex items-start space-x-4">
            {% if review.total_errores > 0 %}
            <div class="p-3 bg-red-100 rounded-lg">
                <i class="fas fa-exclamation-circle text-red-600 text-2xl"></i>
            </div>
            {% elif review.total_advertencias > 0 %}
            <div class="p-3 bg-yellow-100 rounded-lg">
                <i class="fas fa-exclamation-triangle text-yellow-600 text-2xl"></i>
            </div>
            {% else %}
            <div class="p-3 bg-green-100 rounded-lg">
                <i class="fas fa-check-circle text-green-600 text-2xl"></i>
            </div>
            {% endif %}
            <div class="flex-1">
                <h3 class="text-lg font-medium text-gray-900">Evaluacion General</h3>
                <p class="text-gray-600 mt-1">{{ review.evaluacion_general or 'El documento ha sido analizado.' }}</p>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-4 mt-6">
            <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center">
                <span class="text-3xl font-bold text-red-600">{{ review.total_errores }}</span>
                <p class="text-sm text-red-700 mt-1">Error{% if review.total_errores != 1 %}es{% endif %}</p>
            </div>
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
                <span class="text-3xl font-bold text-yellow-600">{{ review.total_advertencias }}</span>
                <p class="text-sm text-yellow-700 mt-1">Advertencia{% if review.total_advertencias != 1 %}s{% endif %}</p>
            </div>
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                <span class="text-3xl font-bold text-blue-600">{{ review.total_sugerencias }}</span>
                <p class="text-sm text-blue-700 mt-1">Sugerencia{% if review.total_sugerencias != 1 %}s{% endif %}</p>
            </div>
        </div>
    </div>

    {% if issues %}
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">
                <i class="fas fa-list-alt text-gray-400 mr-2"></i>Problemas Detectados
            </h3>
        </div>

        <div class="divide-y divide-gray-100">
            {% for issue in issues %}
            <div class="p-6 {% if issue.severidad == 'error' %}bg-red-50{% elif issue.severidad == 'advertencia' %}bg-yellow-50{% else %}bg-blue-50{% endif %}">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0">
                        {% if issue.severidad == 'error' %}
                        <div class="p-2 bg-red-100 rounded-lg">
                            <i class="fas fa-times-circle text-red-600"></i>
                        </div>
                        {% elif issue.severidad == 'advertencia' %}
                        <div class="p-2 bg-yellow-100 rounded-lg">
                            <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                        </div>
                        {% else %}
                        <div class="p-2 bg-blue-100 rounded-lg">
                            <i class="fas fa-lightbulb text-blue-600"></i>
                        </div>
                        {% endif %}
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center space-x-2 mb-2">
                            {% if issue.severidad == 'error' %}
                            <span class="px-2 py-1 bg-red-200 text-red-800 rounded text-xs font-bold uppercase">Error</span>
                            {% elif issue.severidad == 'advertencia' %}
                            <span class="px-2 py-1 bg-yellow-200 text-yellow-800 rounded text-xs font-bold uppercase">Advertencia</span>
                            {% else %}
                            <span class="px-2 py-1 bg-blue-200 text-blue-800 rounded text-xs font-bold uppercase">Sugerencia</span>
                            {% endif %}
                            
                            {% if issue.tipo == 'coherencia' %}
                            <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs">
                                <i class="fas fa-balance-scale mr-1"></i>Coherencia Juridica
                            </span>
                            {% elif issue.tipo == 'contradiccion' %}
                            <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs">
                                <i class="fas fa-not-equal mr-1"></i>Contradiccion
                            </span>
                            {% elif issue.tipo == 'estructura' %}
                            <span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs">
                                <i class="fas fa-list-alt mr-1"></i>Estructura
                            </span>
                            {% elif issue.tipo == 'campo_incompleto' %}
                            <span class="px-2 py-1 bg-pink-100 text-pink-700 rounded text-xs">
                                <i class="fas fa-edit mr-1"></i>Campo Incompleto
                            </span>
                            {% endif %}
                        </div>

                        <p class="text-gray-900 font-medium">{{ issue.descripcion }}</p>

                        {% if issue.ubicacion %}
                        <p class="text-sm text-gray-600 mt-2">
                            <i class="fas fa-map-marker-alt mr-1"></i>
                            <strong>Ubicacion:</strong> {{ issue.ubicacion }}
                        </p>
                        {% endif %}

                        {% if issue.fragmento %}
                        <div class="mt-3 bg-white border border-gray-200 rounded-lg p-3">
                            <p class="text-xs text-gray-500 mb-1">Fragmento del documento:</p>
                            <p class="text-sm text-gray-700 italic">"{{ issue.fragmento }}"</p>
                        </div>
                        {% endif %}

                        {% if issue.recomendacion %}
                        <div class="mt-3 bg-green-50 border border-green-200 rounded-lg p-3">
                            <p class="text-xs text-green-600 mb-1">
                                <i class="fas fa-lightbulb mr-1"></i>Recomendacion:
                            </p>
                            <p class="text-sm text-green-800">{{ issue.recomendacion }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 text-center">
        <div class="p-4 bg-green-100 rounded-full inline-block mb-4">
            <i class="fas fa-check-double text-green-600 text-4xl"></i>
        </div>
        <h3 class="text-xl font-medium text-gray-900 mb-2">Documento sin problemas detectados</h3>
        <p class="text-gray-600">El analisis no encontro errores, contradicciones ni campos incompletos en el documento.</p>
    </div>
    {% endif %}

    <div class="flex justify-center space-x-4">
        <a href="{{ url_for('revisor_ia') }}" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors flex items-center">
            <i class="fas fa-plus mr-2"></i>Nueva Revision
        </a>
        <a href="{{ url_for('revisor_ia_historial') }}" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors flex items-center">
            <i class="fas fa-history mr-2"></i>Ver Historial
        </a>
    </div>
</div>
{% endblock %}
